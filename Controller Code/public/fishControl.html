<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="fish.css">
<link href="fish.js">
<link href="https://fonts.googleapis.com/css?family=Raleway|Roboto" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Josefin+Slab" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lato|Open+Sans+Condensed:300|Pacifico" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Luckiest+Guy|Monoton|Montserrat" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Amatic+SC|Luckiest+Guy|Monoton|Montserrat" rel="stylesheet">
</head>
<body>

<script src="http://192.168.1.66:955/socket.io/socket.io.js"></script>
<script>
    var socket = io("http://192.168.1.66:955");

    socket.on('connected', function() {
        console.log("Connected to PI");
    });

    function poll(gamePad) {
        var gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);
          if (!gamepads) {
            return;
          }

          var gamePad = gamepads[0];

          // 0 = left horizontal
          // 1 = left vertical

          // btn 6 = left trigger
          // btn 7 = right trigger

          if (gamePad.buttons[7].value > .1) {
            console.log("Move forward!")
            socket.emit('speed', { speed: gamePad.buttons[7].value , mulitplier: 250});
            document.getElementById("speed-value").value = Math.round((gamePad.buttons[7].value * 250));
          } else {
            socket.emit('speed', { speed: 1 })
            document.getElementById("speed-value").value = "1";
          }

          if (gamePad.axes[0] > 0.05 || gamePad.axes[0] < -0.05) {
            console.log("Move horizontal")

            socket.emit('rotate', { direction: 'horizontal', value: gamePad.axes[0] });
            document.getElementById("x-rotation").value =  Math.round((gamePad.axes[0] * 45));
          } else {
            socket.emit('rotate', { direction: 'horizontal', value: 0 })
            document.getElementById("x-rotation").value =  0;
          }

          if (gamePad.axes[1] > 0.05 || gamePad.axes[1] < -0.05) {
            console.log("Move vertical")
            socket.emit('rotate', { direction: 'vertical', value: gamePad.axes[1] });
            document.getElementById("y-rotation").value =  -1*Math.round((gamePad.axes[1] * 45));
          } else {
            socket.emit('rotate', { direction: 'vertical', value: 0 })
            document.getElementById("y-rotation").value =  0;
          }




    }

    setInterval(poll, 50)

</script>
  <h2>inFINity control<img src="Fishyy.png"></h2>

  <div class="grid-container">
    <div class="IMUControl">
		  	Manual Control
		  	<label class="switch">
		  		<input type="checkbox">
		  		<span class="slider round"></span>
			</label>
			IMU Control
		</div>

    <div class="speed">
        <br></br>
        <label for="name">Speed Value</label><br></br>
        <input type="number" name="speed-value" id="speed-value" value="0"><br></br>
    </div>

    <div class="XRotVal"><br></br>
        <label for="name">X Rotation</label><br></br>
        <input type="number" name="x-rotation" id="x-rotation" value="0"><br></br>
    </div>

    <div class="YRot"><br></br>
        <label for="name">Y Rotation</label><br></br>
        <input type="number" name="y-rotation" id="y-rotation" value="0"><br></br></div>

    <div class="lightSensorStream">
			<h3>Light sensor stream</h3>
    </div>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="fish.js"></script>
</body>
</html>
